
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>A custom pipeline with more possibilities &#8212; MissMecha 0.0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'auto_examples/plot_custom_pipeline';</script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Amputing with a custom probability function" href="plot_custom_probability_function.html" />
    <link rel="prev" title="Evaluating missing values with grid search and a pipeline" href="plot_simulation_pipeline.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">MissMecha 0.0.1 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../pyampute.html">
    Package pyampute
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../blogposts.html">
    Blogposts
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About us
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../contribution.html">
    Contribution guidelines
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../pyampute.html">
    Package pyampute
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../blogposts.html">
    Blogposts
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about.html">
    About us
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contribution.html">
    Contribution guidelines
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="plot_easy_example.html">A quick example</a></li>
<li class="toctree-l1"><a class="reference internal" href="plot_simulation_pipeline.html">Evaluating missing values with grid search and a pipeline</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">A custom pipeline with more possibilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="plot_custom_probability_function.html">Amputing with a custom probability function</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../examples.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">A custom pipeline with more possibilities</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-custom-pipeline-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="a-custom-pipeline-with-more-possibilities">
<span id="sphx-glr-auto-examples-plot-custom-pipeline-py"></span><h1>A custom pipeline with more possibilities<a class="headerlink" href="#a-custom-pipeline-with-more-possibilities" title="Link to this heading">#</a></h1>
<p>Earlier, we demonstrated how <code class="xref py py-class docutils literal notranslate"><span class="pre">MultivariateAmputation</span></code> can be integrated in a scikit-learn pipeline (see <a class="reference external" href="https://rianneschouten.github.io/pyampute/build/html/auto_examples/plot_easy_example.html">A quick example</a> and <a class="reference external" href="https://rianneschouten.github.io/pyampute/build/html/auto_examples/plot_simulation_pipeline.html">Evaluating missing values with grid search and a pipeline</a>).</p>
<p>It may be valuable to understand the impact of missing values in more detail. Therefore, we demonstrate how a <code class="docutils literal notranslate"><span class="pre">CustomTransformer</span></code> and <code class="docutils literal notranslate"><span class="pre">CustomEstimator</span></code> can be used to do a more thorough analysis. Not only will such analysis gain insights in the statistical problems of missing data (and some imputation methods), but it will also help you to create real-world and realistic missingness scenarios.</p>
<p>Another example, of a more systematic approach, can be found in <a class="reference external" href="https://journals.sagepub.com/doi/full/10.1177/0049124118799376">Schouten and Vink (2021)</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Author: Rianne Schouten &lt;https://rianneschouten.github.io/&gt;</span>
</pre></div>
</div>
<section id="recap">
<h2>Recap<a class="headerlink" href="#recap" title="Link to this heading">#</a></h2>
<blockquote>
<div><p>Given is the following setting (from <a class="reference external" href="https://rianneschouten.github.io/pyampute/build/html/auto_examples/plot_simulation_pipeline.html">Evaluating missing values with grid search and a pipeline</a>):</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">m</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="n">cor</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">cov</span><span class="p">[</span><span class="n">cov</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cor</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
<span class="n">compl_dataset</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>As amputation parameter settings, we will vary the proportion, the mechanism and the <code class="docutils literal notranslate"><span class="pre">score_to_probability_func</span></code>. Since in  the latter have to be specified within the same dictionary, we define the parameters for the grid search as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">it</span>

<span class="n">mechs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;MAR&quot;</span><span class="p">,</span> <span class="s2">&quot;MNAR&quot;</span><span class="p">]</span>
<span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sigmoid-right&quot;</span><span class="p">,</span> <span class="s2">&quot;sigmoid-mid&quot;</span><span class="p">]</span>

<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;amputation__prop&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span>
    <span class="s2">&quot;amputation__patterns&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[{</span><span class="s2">&quot;incomplete_vars&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;mechanism&quot;</span><span class="p">:</span> <span class="n">mechanism</span><span class="p">,</span> <span class="s2">&quot;score_to_probability_func&quot;</span><span class="p">:</span> <span class="n">func</span><span class="p">}]</span>
        <span class="k">for</span> <span class="n">mechanism</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">mechs</span><span class="p">,</span> <span class="n">funcs</span><span class="p">))]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="a-transformer-that-drops-incomplete-rows">
<h2>A transformer that drops incomplete rows<a class="headerlink" href="#a-transformer-that-drops-incomplete-rows" title="Link to this heading">#</a></h2>
<blockquote>
<div><p>Previously, we evaluated the <code class="docutils literal notranslate"><span class="pre">SimpleImputer</span></code> class from scikit-learn. Another good way to evaluate the effect of missing values, is by analyzing the incomplete dataset directly. Since most prediction and analysis models do not accept missing values, we apply the <cite>dropna</cite> or <cite>listwise deletion</cite> or <cite>complete case analysis</cite> method (all names refer to the same strategy). To allow for integration in a pipeline, we set up a custom <code class="docutils literal notranslate"><span class="pre">TransformerMixin</span></code>.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">TransformerMixin</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DropTransformer</span><span class="p">(</span><span class="n">TransformerMixin</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># drop incomplete rows</span>
        <span class="n">Xp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">Xdrop</span> <span class="o">=</span> <span class="n">Xp</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">Xdrop</span>
</pre></div>
</div>
</section>
<section id="a-custom-estimator">
<h2>A custom estimator<a class="headerlink" href="#a-custom-estimator" title="Link to this heading">#</a></h2>
<blockquote>
<div><p>Almost all, if not all, estimators and evaluation metrics in scikit-learn are aimed at prediction or classification. That is what most people want to do.</p>
<p>However, for evaluating the effect of missing values on your model, it may be good to look further than just the prediction or classification accuracy. In this example, we will focus on the center of the distribution of one feature and evaluate the bias in that distribution.</p>
<p>That could work as follows.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseEstimator</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomEstimator</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

        <span class="c1"># return values of first feature</span>
        <span class="n">values_used_for_score</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">values_used_for_score</span>

<span class="k">def</span><span class="w"> </span><span class="nf">my_evaluation_metric</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>

    <span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>

    <span class="n">bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m1</span> <span class="o">-</span> <span class="n">m2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bias</span>
</pre></div>
</div>
</section>
<section id="an-evaluation-pipeline">
<h2>An evaluation pipeline<a class="headerlink" href="#an-evaluation-pipeline" title="Link to this heading">#</a></h2>
<blockquote>
<div><p>As can be seen, the <code class="docutils literal notranslate"><span class="pre">predict</span></code> function returns the first feature of the transformed dataset. The evaluation metric then calculated the mean difference between that feature, and the truth.</p>
<p>In our experiment, the complete dataset is the ground truth and we evaluate the impact of several missing data models (and imputation models) on that truth.</p>
<p>We then run the pipeline twice.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyampute.ampute</span><span class="w"> </span><span class="kn">import</span> <span class="n">MultivariateAmputation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_scorer</span>
</pre></div>
</div>
<p>Once with the DropTransformer</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">steps</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;amputation&#39;</span><span class="p">,</span> <span class="n">MultivariateAmputation</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;imputation&#39;</span><span class="p">,</span> <span class="n">DropTransformer</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;estimator&#39;</span><span class="p">,</span> <span class="n">CustomEstimator</span><span class="p">())]</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipe</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">make_scorer</span><span class="p">(</span><span class="n">my_evaluation_metric</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">compl_dataset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">compl_dataset</span><span class="p">)))</span>
<span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">compl_dataset</span><span class="p">,</span> <span class="n">compl_dataset</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">results_drop</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
</pre></div>
</div>
<p>Once with the SimpleImputer</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">steps</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;amputation&#39;</span><span class="p">,</span> <span class="n">MultivariateAmputation</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;imputation&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;estimator&#39;</span><span class="p">,</span> <span class="n">CustomEstimator</span><span class="p">())]</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipe</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">make_scorer</span><span class="p">(</span><span class="n">my_evaluation_metric</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">compl_dataset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">compl_dataset</span><span class="p">)))</span>
<span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">compl_dataset</span><span class="p">,</span> <span class="n">compl_dataset</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">results_mean</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="comparison">
<h2>Comparison<a class="headerlink" href="#comparison" title="Link to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res_drop</span> <span class="o">=</span> <span class="n">results_drop</span><span class="p">[[</span><span class="s1">&#39;param_amputation__patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;param_amputation__prop&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_test_score&#39;</span><span class="p">]]</span>
<span class="n">res_mean</span> <span class="o">=</span> <span class="n">results_mean</span><span class="p">[[</span><span class="s1">&#39;param_amputation__patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;param_amputation__prop&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_test_score&#39;</span><span class="p">]]</span>

<span class="n">res_drop</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mechanism, func&#39;</span><span class="p">,</span> <span class="s1">&#39;prop&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">]</span>
<span class="n">res_mean</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mechanism, func&#39;</span><span class="p">,</span> <span class="s1">&#39;prop&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">]</span>

<span class="n">res_drop</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mechanism, func</th>
      <th>prop</th>
      <th>score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.1</td>
      <td>4.998796</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.5</td>
      <td>4.998061</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.9</td>
      <td>4.993133</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.1</td>
      <td>5.005670</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.5</td>
      <td>5.010373</td>
    </tr>
    <tr>
      <th>5</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.9</td>
      <td>5.024687</td>
    </tr>
    <tr>
      <th>6</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.1</td>
      <td>4.945268</td>
    </tr>
    <tr>
      <th>7</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.5</td>
      <td>4.748383</td>
    </tr>
    <tr>
      <th>8</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.9</td>
      <td>4.510414</td>
    </tr>
    <tr>
      <th>9</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.1</td>
      <td>4.998428</td>
    </tr>
    <tr>
      <th>10</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.5</td>
      <td>5.014696</td>
    </tr>
    <tr>
      <th>11</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.9</td>
      <td>4.972411</td>
    </tr>
    <tr>
      <th>12</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.1</td>
      <td>4.917843</td>
    </tr>
    <tr>
      <th>13</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.5</td>
      <td>4.636337</td>
    </tr>
    <tr>
      <th>14</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.9</td>
      <td>4.312762</td>
    </tr>
    <tr>
      <th>15</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.1</td>
      <td>4.993687</td>
    </tr>
    <tr>
      <th>16</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.5</td>
      <td>4.999428</td>
    </tr>
    <tr>
      <th>17</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.9</td>
      <td>4.970546</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res_mean</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mechanism, func</th>
      <th>prop</th>
      <th>score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.1</td>
      <td>4.999176</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.5</td>
      <td>5.003938</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.9</td>
      <td>4.991379</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.1</td>
      <td>5.002979</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.5</td>
      <td>4.999179</td>
    </tr>
    <tr>
      <th>5</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MCA...</td>
      <td>0.9</td>
      <td>5.013873</td>
    </tr>
    <tr>
      <th>6</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.1</td>
      <td>4.944237</td>
    </tr>
    <tr>
      <th>7</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.5</td>
      <td>4.749489</td>
    </tr>
    <tr>
      <th>8</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.9</td>
      <td>4.520981</td>
    </tr>
    <tr>
      <th>9</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.1</td>
      <td>4.996579</td>
    </tr>
    <tr>
      <th>10</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.5</td>
      <td>5.004579</td>
    </tr>
    <tr>
      <th>11</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MAR...</td>
      <td>0.9</td>
      <td>5.010057</td>
    </tr>
    <tr>
      <th>12</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.1</td>
      <td>4.916333</td>
    </tr>
    <tr>
      <th>13</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.5</td>
      <td>4.639330</td>
    </tr>
    <tr>
      <th>14</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.9</td>
      <td>4.310698</td>
    </tr>
    <tr>
      <th>15</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.1</td>
      <td>4.999446</td>
    </tr>
    <tr>
      <th>16</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.5</td>
      <td>4.992550</td>
    </tr>
    <tr>
      <th>17</th>
      <td>[{'incomplete_vars': [0, 1], 'mechanism': 'MNA...</td>
      <td>0.9</td>
      <td>5.023169</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<br />
<br /><p>What you find here, is that a MCAR mechanism will not affect the center of the distribution of the first feature much, independent of the proportion of incomplete rows.</p>
<p>A MAR mechanism with a sigmoid-right probability function will, on average, remove the right-hand side of the distribution (also, because there is a positive correlation between the observed data and the first feature). Therefore, the larger the proportion, the more bias. However, with a sigmoid-mid probability function, values in the center of the distribution of the first feature are removed, and there is therefore not much effect on the bias.</p>
<p>The same logic applies to MNAR missingness, but since MNAR missingness does not depend on the size of the correlation between observed data and incomplete data, the bias will be stronger.</p>
<p><a class="reference external" href="https://journals.sagepub.com/doi/full/10.1177/0049124118799376">Schouten and Vink (2021)</a> further discuss this topic and the effect of multiple imputation (which can be performed using scikit-learn’s IterativeImputer).</p>
<p>SimpleImputer will use the mean of the observed data in the first feature. Therefore, in case there is any bias, that bias will remain. In case there is no bias, mean imputation will distort the correlation structure with other features. But that is another story…</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  6.931 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-custom-pipeline-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/c970eafe109229d0e12c897814f9eaed/plot_custom_pipeline.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_custom_pipeline.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/c582f26e1fb15e5009e0cbaadf9aa696/plot_custom_pipeline.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_custom_pipeline.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="plot_simulation_pipeline.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Evaluating missing values with grid search and a pipeline</p>
      </div>
    </a>
    <a class="right-next"
       href="plot_custom_probability_function.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Amputing with a custom probability function</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap">Recap</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-transformer-that-drops-incomplete-rows">A transformer that drops incomplete rows</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-custom-estimator">A custom estimator</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-evaluation-pipeline">An evaluation pipeline</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison">Comparison</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/auto_examples/plot_custom_pipeline.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Youran Zhou.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>